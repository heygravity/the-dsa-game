document.addEventListener('DOMContentLoaded', () => {
    const gameContainer = document.getElementById('game-container');
    const movesCountSpan = document.getElementById('moves-count');
    const resetButton = document.getElementById('reset-btn');
    const hintButton = document.getElementById('hint-btn');
    const nextLessonButton = document.getElementById('next-lesson-btn');
    const prevLessonButton = document.getElementById('prev-lesson-btn');
    const congratsMessage = document.getElementById('congrats-message');
    const gameStatus = document.getElementById('game-status');

    const insertSound = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAABoR2RFSW5mbwAAAA8AAAAIAAADeGF2Y0efg5//+xDEAAAAAAPof4gsEAAAAAAB1AQR2AAAAAAB3d3cueG1wLm9yZwAAAAAAeG1wOkNyZWF0b3JUb29sAAAAAABMYXZjNTguNDUuMTAwAP/7EMQCAAACAAACA3gAc291bmRmb3JnZS5uZXQAAAAAAAAAP/7EMQCAAACAAACA3gAc291bmRmb3JnZS5uZXQAAAAAAAAA//sQxAgAAAIAAAIDeABzb3VuZGZvcmdlLm5ldAAAAAAAAAD/9BDEHQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEIQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/+xDEIAAACAAABA3gAAAAAAAAAAAAAAP/7EMQYAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBsAAAEAAAEAAAAAAAAAAAAAAAAD/9BDEHQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEIQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9-BDEJAAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEJwAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAACAAAAP/sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQ-QxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//-xDEIgAAAgAAAQN4AANwAAAAAAAAAAAAA//sQxBsAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBgAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBQAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBQAIAAAAAEAAAD/9BDEAgAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/AAaniaAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIA");
    const errorSound = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAABoR2RFSW5mbwAAAA8AAAAIAAADeGF2Y0efg5//+xDEAAAAAAPof4gsEAAAAAAB1AQR2AAAAAAB3d3cueG1wLm9yZwAAAAAAeG1wOkNyZWF0b3JUb29sAAAAAABMYXZjNTguNDUuMTAwAP/7EMQCAAACAAACA3gAc291bmRmb3JnZS5uZXQAAAAAAAAAP/7EMQCAAACAAACA3gAc291bmRmb3JnZS5uZXQAAAAAAAAA//sQxAgAAAIAAAIDeABzb3VuZGZvcmdlLm5ldAAAAAAAAAD/9BDEHQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEIQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/+xDEIAAACAAABA3gAAAAAAAAAAAAAAP/7EMQYAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBsAAAEAAAEAAAAAAAAAAAAAAAAD/9BDEHQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEIQAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9-BDEJAAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/9BDEJwAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAACAAAAP/sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQ-QxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//sQxCoAAAMAADSAAAA//-xDEIgAAAgAAAQN4AANwAAAAAAAAAAAAA//sQxBsAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBgAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBQAAAEAAAEAAAAAAAAAAAAAAAAAAAAA//sQxBQAIAAAAAEAAAD/9BDEAgAIAAAAEAAADSAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAAD/AAaniaAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIAAAANIA");

    let bars = [];
    let moves = 0;
    let currentIndex = 1;
    let isGameWon = false;
    const BAR_COUNT = 7;

    function playSound(sound) {
        const playPromise = sound.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.info("Audio playback failed:", error);
            });
        }
    }

    function createBars() {
        isGameWon = false;
        currentIndex = 1;
        moves = 0;
        congratsMessage.classList.remove('visible');
        updateMoves(0);
        gameContainer.innerHTML = '';
        bars = [];

        const values = Array.from({ length: BAR_COUNT }, (_, i) => i + 1);
        for (let i = values.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [values[i], values[j]] = [values[j], values[i]];
        }

        values.forEach((value) => {
            const bar = document.createElement('div');
            bar.dataset.value = value;
            bar.style.height = `${value * 30}px`;
            bar.classList.add('bar');
            bar.addEventListener('click', onBarClick);
            gameContainer.appendChild(bar);
            bars.push(bar);
        });
        
        updateBarClasses();
        updateGameStatus();
    }
    
    function updateBarClasses() {
        bars.forEach((bar, i) => {
            bar.classList.remove('sorted', 'key');
            if (i < currentIndex) {
                bar.classList.add('sorted');
            } else if (i === currentIndex) {
                bar.classList.add('key');
            }
        });
    }

    function onBarClick(event) {
        if (isGameWon || currentIndex >= BAR_COUNT) return;

        const clickedBar = event.target;
        removeHint();
        
        const keyBar = bars[currentIndex];
        const keyVal = parseInt(keyBar.dataset.value);
        const clickedIndex = bars.indexOf(clickedBar);

        // Only allow clicks on sorted bars or the spot at the beginning
        if(clickedIndex >= currentIndex) return;

        let correctIndex = 0;
        while(correctIndex < currentIndex && parseInt(bars[correctIndex].dataset.value) < keyVal) {
            correctIndex++;
        }

        if (clickedIndex === correctIndex) {
            handleCorrectInsertion(keyBar, clickedBar);
        } else {
            handleIncorrectSelection(clickedBar);
        }
    }
    
    function handleCorrectInsertion(keyBar, targetBar) {
        playSound(insertSound);
        updateMoves(moves + 1);

        const oldIndex = bars.indexOf(keyBar);
        bars.splice(oldIndex, 1);
        
        const newIndex = bars.indexOf(targetBar);
        bars.splice(newIndex, 0, keyBar);

        // Re-render all bars in the new order
        bars.forEach(bar => gameContainer.appendChild(bar));
        
        currentIndex++;

        if (currentIndex >= BAR_COUNT) {
            isGameWon = true;
            bars.forEach((bar, index) => {
                setTimeout(() => bar.classList.add('dance'), index * 100);
            });
            setTimeout(() => congratsMessage.classList.add('visible'), 800);
        }
        
        updateBarClasses();
        updateGameStatus();
    }

    function handleIncorrectSelection(clickedBar) {
        playSound(errorSound);
        if(clickedBar && clickedBar.classList) {
            clickedBar.classList.add('incorrect');
            setTimeout(() => {
                clickedBar.classList.remove('incorrect');
            }, 500);
        }
    }
    
    function updateMoves(count) {
        moves = count;
        movesCountSpan.textContent = moves;
    }
    
    function updateGameStatus() {
        const gameStatusDiv = document.getElementById('game-status');
        if (isGameWon) {
            gameStatusDiv.textContent = 'Congratulations! You sorted the list!';
            gameStatusDiv.className = 'text-center my-4 p-2 rounded-lg font-semibold bg-green-100 text-green-800';
        } else {
            gameStatusDiv.textContent = `Insert the yellow bar into the correct position in the sorted (green) section.`;
            gameStatusDiv.className = 'text-center my-4 p-2 rounded-lg font-semibold bg-yellow-100 text-yellow-800';
        }
    }

    function getHint() {
        if (isGameWon) return;
        removeHint();
        const keyBar = bars[currentIndex];
        const keyVal = parseInt(keyBar.dataset.value);

        let correctIndex = 0;
        while(correctIndex < currentIndex && parseInt(bars[correctIndex].dataset.value) < keyVal) {
            correctIndex++;
        }
        
        if (correctIndex < bars.length) {
            bars[correctIndex].classList.add('hint');
        }
    }

    function removeHint() {
        bars.forEach(b => b.classList.remove('hint'));
    }

    resetButton.addEventListener('click', createBars);
    hintButton.addEventListener('click', getHint);
    nextLessonButton.addEventListener('click', () => {
        alert('More lessons coming soon!');
    });
    prevLessonButton.addEventListener('click', () => {
        window.location.href = '../lesson-2/index.html';
    });
    document.getElementById('copyright-year').textContent = new Date().getFullYear();

    createBars();
});